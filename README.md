# üìä Web An√°lisis WSP - Plataforma de An√°lisis Comercial WhatsApp

Una aplicaci√≥n web moderna y completamente **responsive** para analizar conversaciones de WhatsApp con inteligencia artificial. Construida con **React 19 + TypeScript** siguiendo principios de **Clean Architecture** y **SOLID**.

## üöÄ Caracter√≠sticas Principales

### ‚úÖ **Funcionalidades Implementadas**
- **ü§ñ An√°lisis de Sentimientos con IA**: Detecta emociones en conversaciones (-1 a +1)
- **üéØ An√°lisis de Intenciones**: Identifica prop√≥sitos del cliente (compra, queja, consulta, etc.)
- **üìä Dashboard Din√°mico**: M√©tricas en tiempo real con visualizaci√≥n moderna
- **üìÅ Procesamiento Inteligente de Excel/CSV**: Extrae datos autom√°ticamente con mapeo flexible
- **‚òÅÔ∏è Storage en la Nube**: Integraci√≥n con Supabase para archivos
- **üìà An√°lisis por Lotes**: Procesa m√∫ltiples conversaciones optimizando costos de API
- **üìã Exportaci√≥n Avanzada**: Reportes en PDF y Excel con datos completos
- **üîÑ Estado Global**: Gesti√≥n eficiente con Zustand

### üí´ **UX/UI Moderna y Responsive**
- **üì± Dise√±o completamente responsive**: Desktop, tablet y m√≥vil
- **‚ú® Animaciones fluidas**: Loading states y transiciones con Framer Motion
- **üé® Interfaz moderna**: Glass morphism, gradientes y Tailwind CSS
- **üîî Sistema de notificaciones**: React Hot Toast para feedback visual
- **‚ö° Navegaci√≥n fluida**: React Router DOM con rutas optimizadas

### üèóÔ∏è **Arquitectura Robusta**
- **üéØ Clean Architecture**: Separaci√≥n clara de dominio, aplicaci√≥n y presentaci√≥n
- **üìê Principios SOLID**: C√≥digo mantenible y escalable
- **üîÑ State Management**: Zustand para estado global eficiente
- **üõ°Ô∏è TypeScript**: Tipado fuerte con interfaces y entidades bien definidas
- **üìù Validaci√≥n**: Zod para validaci√≥n de esquemas y React Hook Form

## üõ†Ô∏è Stack Tecnol√≥gico

### **Frontend Core**
- **React 19.1.0** - Framework principal con las √∫ltimas caracter√≠sticas
- **TypeScript 5.8.3** - Tipado est√°tico para mayor seguridad
- **Vite 6.3.5** - Bundler ultra r√°pido con HMR
- **CSS Modules + Tailwind CSS 4.1.8** - Estilos modulares y utilitarios

### **Estado y Navegaci√≥n**
- **Zustand 4.5.7** - Estado global liviano y eficiente
- **React Router DOM 6.8.0** - Navegaci√≥n SPA
- **React Hook Form 7.48.0** - Formularios performantes
- **Zod 3.22.0** - Validaci√≥n de esquemas

### **UI/UX y Animaciones**
- **Framer Motion 11.18.2** - Animaciones avanzadas
- **Lucide React 0.511.0** - Iconograf√≠a moderna
- **React Hot Toast 2.5.2** - Notificaciones elegantes
- **CLSX 2.0.0** - Utilidad para clases CSS condicionales

### **Servicios Externos y APIs**
- **OpenAI 5.1.0** - An√°lisis de conversaciones con GPT
- **Supabase 2.49.9** - Storage de archivos y backend
- **TanStack React Query 5.0.0** - Gesti√≥n de estado del servidor

### **Procesamiento de Datos**
- **XLSX 0.18.5** - Lectura/escritura de archivos Excel
- **PapaParse 5.4.0** - Procesamiento de CSV
- **Date-fns 2.30.0** - Manipulaci√≥n de fechas

### **Exportaci√≥n y Reportes**
- **jsPDF 3.0.1** - Generaci√≥n de PDFs
- **jsPDF AutoTable 5.0.2** - Tablas en PDF
- **HTML2Canvas 1.4.1** - Captura de elementos DOM
- **Recharts 2.8.0** - Gr√°ficos y visualizaciones

### **Desarrollo y Calidad**
- **ESLint 9.27.0** - Linting con configuraci√≥n moderna
- **Prettier 3.5.3** - Formateo autom√°tico de c√≥digo
- **Vitest 1.0.0** - Framework de testing
- **Testing Library** - Utilidades para testing de componentes

## üìÅ Estructura del Proyecto

```
src/
‚îú‚îÄ‚îÄ domain/                    # üéØ L√≥gica de negocio pura
‚îÇ   ‚îú‚îÄ‚îÄ entities/             # Modelos de datos y tipos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Conversation.ts   # Entidad conversaci√≥n con filtros
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AnalysisResult.ts # Resultados de an√°lisis IA
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DashboardMetrics.ts # M√©tricas del dashboard
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WhatsAppMessage.ts # Mensajes individuales
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts         # Exportaciones centralizadas
‚îÇ   ‚îî‚îÄ‚îÄ interfaces/          # Contratos de servicios
‚îÇ       ‚îú‚îÄ‚îÄ IConversationRepository.ts
‚îÇ       ‚îú‚îÄ‚îÄ IFileProcessor.ts
‚îÇ       ‚îî‚îÄ‚îÄ IAnalysisService.ts
‚îú‚îÄ‚îÄ application/             # üîß Casos de uso (l√≥gica de aplicaci√≥n)
‚îÇ   ‚îî‚îÄ‚îÄ usecases/
‚îÇ       ‚îú‚îÄ‚îÄ ProcessFileUseCase.ts       # Procesamiento de archivos
‚îÇ       ‚îî‚îÄ‚îÄ GetDashboardMetricsUseCase.ts # M√©tricas dashboard
‚îú‚îÄ‚îÄ infrastructure/          # üîå Servicios externos e implementaciones
‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ       ‚îú‚îÄ‚îÄ OpenAIAnalysisService.ts    # Integraci√≥n OpenAI
‚îÇ       ‚îú‚îÄ‚îÄ ExcelFileProcessor.ts       # Procesamiento Excel/CSV
‚îÇ       ‚îú‚îÄ‚îÄ SupabaseStorageService.ts   # Storage en la nube
‚îÇ       ‚îî‚îÄ‚îÄ InMemoryConversationRepository.ts
‚îú‚îÄ‚îÄ presentation/            # üé® Capa de presentaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ components/          # Componentes React
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Layout/          # Layout principal con navegaci√≥n
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dashboard/       # Dashboard con m√©tricas y gr√°ficos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FileUploader/    # Componente drag & drop avanzado
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ExportPage/      # P√°gina de exportaci√≥n
‚îÇ   ‚îî‚îÄ‚îÄ store/              # Estado global
‚îÇ       ‚îî‚îÄ‚îÄ useAppStore.ts  # Store Zustand centralizado
‚îú‚îÄ‚îÄ App.tsx                 # Componente principal con rutas
‚îú‚îÄ‚îÄ App.css                # Estilos globales y responsive
‚îî‚îÄ‚îÄ main.tsx               # Punto de entrada de la aplicaci√≥n
```

## üîß Configuraci√≥n e Instalaci√≥n

### **1. Prerrequisitos**
- Node.js 18+ (recomendado: 20.x)
- NPM o Yarn
- Cuenta de OpenAI con API key
- Proyecto de Supabase configurado

### **2. Instalaci√≥n**

```bash
# Clonar repositorio
git clone [tu-repositorio]
cd web-analisis-wsp

# Instalar dependencias
npm install

# Copiar variables de entorno
cp .env.example .env
```

### **3. Configuraci√≥n de Variables de Entorno**

Edita el archivo `.env` con tus credenciales:

```bash
# OpenAI Configuration (REQUERIDO)
VITE_OPENAI_API_KEY=sk-TU-CLAVE-DE-OPENAI-AQUI
VITE_OPENAI_MODEL=gpt-3.5-turbo
VITE_OPENAI_MAX_TOKENS=800
VITE_OPENAI_TEMPERATURE=0.3

# Supabase Configuration (REQUERIDO)
VITE_SUPABASE_URL=https://tu-proyecto.supabase.co
VITE_SUPABASE_ANON_KEY=tu-clave-publica-aqui

# Application Configuration
VITE_APP_NAME=Web An√°lisis WSP
VITE_APP_VERSION=1.0.0

# File Processing Configuration
VITE_MAX_FILE_SIZE_MB=25
VITE_BATCH_SIZE=3

# Analysis Configuration
VITE_ENABLE_BATCH_PROCESSING=true
VITE_RATE_LIMIT_DELAY=1500
VITE_ENABLE_FALLBACK_ANALYSIS=true
```

### **4. Configuraci√≥n de OpenAI**

1. Ve a [OpenAI Platform](https://platform.openai.com/api-keys)
2. Inicia sesi√≥n o crea una cuenta
3. Crea una nueva API key
4. Copia la clave que comienza con `sk-`
5. P√©gala en tu archivo `.env`

#### **üí∞ Modelos Recomendados por Presupuesto**

| Modelo | Costo por 1K tokens | Ideal para |
|--------|-------------------|------------|
| `gpt-3.5-turbo` | ~$0.002 | An√°lisis b√°sico, presupuestos limitados |
| `gpt-4-turbo-preview` | ~$0.01-0.03 | An√°lisis profesional, insights detallados |
| `gpt-4` | ~$0.03-0.06 | An√°lisis de m√°xima precisi√≥n |

### **5. Configuraci√≥n de Supabase**

1. Ve a [Supabase](https://supabase.com) y crea un nuevo proyecto
2. Ve a Settings > API para obtener las credenciales
3. Configura el Storage Bucket (ver secci√≥n espec√≠fica abajo)

### **6. Iniciar la aplicaci√≥n**

```bash
# Desarrollo
npm run dev

# Build de producci√≥n
npm run build

# Preview del build
npm run preview
```

La aplicaci√≥n estar√° disponible en `http://localhost:5173`

## üóÑÔ∏è Configuraci√≥n de Supabase Storage

### **1. Crear Bucket para Archivos Excel**

En tu panel de Supabase:

1. Ve a **Storage** > **Buckets**
2. Crear nuevo bucket:
   - **Name**: `excel-files`
   - **Public**: No (privado)
   - **File size limit**: 25MB
   - **Allowed MIME types**: `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel,text/csv`

### **2. Configurar Pol√≠ticas de Seguridad (RLS)**

Ejecuta estos comandos SQL en el editor de Supabase:

```sql
-- Pol√≠tica para permitir subida de archivos
CREATE POLICY "Allow file uploads" ON storage.objects
FOR INSERT WITH CHECK (bucket_id = 'excel-files');

-- Pol√≠tica para permitir lectura de archivos
CREATE POLICY "Allow file downloads" ON storage.objects
FOR SELECT USING (bucket_id = 'excel-files');

-- Pol√≠tica para permitir eliminaci√≥n de archivos (opcional)
CREATE POLICY "Allow file deletion" ON storage.objects
FOR DELETE USING (bucket_id = 'excel-files');
```

## üìã Formato de Archivo Excel/CSV Esperado

### **Columnas Reconocidas Autom√°ticamente**

| Campo | Nombres Reconocidos |
|-------|-------------------|
| **Cliente** | cliente, customer_name, name, nombre, usuario |
| **Tel√©fono** | telefono, phone, numero, whatsapp, celular |
| **Fecha** | fecha, date, fecha_inicio, start_date, timestamp |
| **Estado** | estado, status, estado_conversacion |
| **Mensajes** | mensajes, messages, total_messages, cantidad_mensajes |
| **√öltimo Mensaje** | ultimo_mensaje, last_message, mensaje_final |
| **Agente** | agente, agent, vendedor, assigned_agent |

### **Ejemplo de Archivo Excel**

```
| Cliente        | Tel√©fono     | Fecha      | Estado      | Mensajes | √öltimo Mensaje        | Agente |
|---------------|--------------|------------|-------------|----------|--------------------- |--------|
| Juan P√©rez    | +52555123456 | 2024-01-15 | completado  | 12       | Gracias por la compra | Ana    |
| Mar√≠a Garc√≠a  | +52555789012 | 2024-01-16 | pendiente   | 3        | ¬øTienen disponible?   | Luis   |
| Pedro L√≥pez   | +52555345678 | 2024-01-17 | abandonado  | 7        | Muy caro             |        |
```

## üéØ Funcionalidades del Sistema

### **1. An√°lisis de Sentimientos**
- **Puntuaci√≥n**: -1 (muy negativo) a +1 (muy positivo)
- **Etiquetas**: very_negative, negative, neutral, positive, very_positive
- **Palabras clave**: T√©rminos que influyeron en el an√°lisis
- **Nivel de confianza**: Precisi√≥n del an√°lisis

### **2. An√°lisis de Intenciones**
- üõí Consulta de precios (`price_inquiry`)
- üì¶ Verificaci√≥n de stock (`stock_check`)
- üí≥ Intenci√≥n de compra (`purchase_intent`)
- ‚ùå Queja (`complaint`)
- üõ†Ô∏è Soporte t√©cnico (`support`)
- ‚ÑπÔ∏è Informaci√≥n general (`general_info`)
- üí∞ Negociaci√≥n (`negotiation`)
- üìû Seguimiento (`follow_up`)

### **3. Dashboard con M√©tricas Avanzadas**
- üìä Total de conversaciones procesadas
- ‚úÖ Ventas completadas y tasa de conversi√≥n
- ‚ùå Chats abandonados y razones
- ‚è±Ô∏è Tiempo promedio de respuesta
- üòä Puntuaci√≥n de satisfacci√≥n del cliente
- üìà An√°lisis de tendencias temporales
- üïê An√°lisis de actividad por horas pico

### **4. Exportaci√≥n Completa**
- üìÑ **PDF**: Reportes detallados con gr√°ficos
- üìä **Excel**: Datos completos con an√°lisis
- üéØ **Filtros personalizables**: Por fecha, estado, agente
- üìã **Res√∫menes ejecutivos**: KPIs principales

## üö¶ Flujo de Uso

### **1. Preparar Archivo**
```
‚úÖ Organiza datos en Excel/CSV
‚úÖ Incluye columnas obligatorias: Cliente, Tel√©fono
‚úÖ Usa nombres de columna reconocidos
‚úÖ M√°ximo 25MB de tama√±o
```

### **2. Subir y Procesar**
```
üìÅ Selecciona archivo ‚Üí Validaci√≥n autom√°tica
‚òÅÔ∏è Subida a Supabase ‚Üí Almacenamiento seguro
ü§ñ Procesamiento con IA ‚Üí An√°lisis en lotes
üìä Resultados ‚Üí Dashboard actualizado
```

### **3. Analizar Resultados**
```
üéØ Dashboard ‚Üí M√©tricas generales y KPIs
üí¨ Conversaciones ‚Üí Lista detallada con an√°lisis IA
üìä Exportar ‚Üí Reportes en PDF/Excel
```

## üõ†Ô∏è Scripts de Desarrollo

```bash
# Desarrollo
npm run dev          # Servidor con hot reload
npm run build        # Build optimizado para producci√≥n
npm run preview      # Preview del build

# Calidad de c√≥digo
npm run lint         # Ejecutar ESLint
npm run lint:fix     # Corregir errores autom√°ticamente
npm run format       # Formatear con Prettier

# Testing y an√°lisis
npm run test         # Ejecutar tests con Vitest
npm run analyze      # An√°lisis del bundle con vite-bundle-analyzer
```

## üé® Componentes Principales

### **Dashboard**
- M√©tricas en tiempo real con animaciones
- Tarjetas de KPIs con tendencias
- Grid responsivo con CSS Modules
- Loading states elegantes

### **FileUploader**
- Drag & drop con feedback visual
- Validaci√≥n de tipos y tama√±o
- Progress bar para subidas
- Integraci√≥n con Supabase Storage

### **ExportPage**
- Configuraci√≥n flexible de exportaci√≥n
- Preview de datos antes de exportar
- M√∫ltiples formatos (PDF, Excel)
- Filtros por fecha y categor√≠as

### **Layout**
- Navegaci√≥n responsive
- Header con branding
- Footer informativo
- Rutas optimizadas con React Router

## üîç Troubleshooting

### **‚ùå Error: "VITE_OPENAI_API_KEY es requerida"**
```bash
‚úÖ Verifica que el archivo .env existe
‚úÖ Aseg√∫rate de que la clave comience con sk-
‚úÖ Reinicia el servidor (npm run dev)
```

### **‚ùå Error: "Supabase connection failed"**
```bash
‚úÖ Verifica credenciales en .env
‚úÖ Confirma que el bucket excel-files existe
‚úÖ Revisa pol√≠ticas RLS configuradas
```

### **‚ùå Error: "Formato no soportado"**
```bash
‚úÖ Usa archivos .xlsx, .xls o .csv
‚úÖ Verifica que no est√© corrupto
‚úÖ M√°ximo 25MB de tama√±o
```

### **‚ö†Ô∏è An√°lisis Incompleto**
```bash
‚úÖ Revisa cr√©ditos de OpenAI
‚úÖ Verifica conexi√≥n a internet
‚úÖ Considera usar GPT-3.5 para ahorrar costos
```

## üìà Pr√≥ximas Funcionalidades

- [ ] üóÑÔ∏è Base de datos persistente con Supabase Database
- [ ] üîê Sistema de autenticaci√≥n de usuarios
- [ ] üîå API REST para integraci√≥n externa
- [ ] üìä Dashboard con gr√°ficos interactivos (Chart.js/D3)
- [ ] üö® Alertas autom√°ticas por sentimientos negativos
- [ ] üì± Integraci√≥n directa con WhatsApp Business API
- [ ] üîÑ Sincronizaci√≥n en tiempo real
- [ ] üåê Soporte multi-idioma (i18n)
- [ ] üß™ Testing automatizado con CI/CD
- [ ] üì± PWA (Progressive Web App)

## üöÄ Optimizaciones Implementadas

### **Performance**
- ‚ö° Vite con HMR ultra r√°pido
- üéØ Code splitting autom√°tico
- üì¶ Bundle optimizado para producci√≥n
- üîÑ React Query para cache inteligente

### **UX/UX**
- üì± Dise√±o mobile-first responsive
- ‚ú® Animaciones fluidas con Framer Motion
- üé® CSS Modules para estilos modulares
- üîî Notificaciones toast elegantes

### **Desarrollo**
- üõ°Ô∏è TypeScript para type safety
- üìê Clean Architecture para mantenibilidad
- üîß ESLint + Prettier para calidad de c√≥digo
- üß™ Testing setup con Vitest

## üí° Mejores Pr√°cticas Implementadas

1. **üéØ Arquitectura Limpia**: Separaci√≥n clara de responsabilidades
2. **üìä Estado Inmutable**: Zustand con patrones inmutables
3. **üîí Tipado Fuerte**: Interfaces bien definidas en TypeScript
4. **üß™ C√≥digo Testeable**: Componentes y funciones puras
5. **üì± Mobile First**: Dise√±o responsive desde el inicio
6. **‚ö° Performance**: Lazy loading y optimizaciones
7. **üîß DX**: Herramientas de desarrollo optimizadas

## ü§ù Contribuci√≥n

Para contribuir al proyecto:

1. üç¥ Fork el repositorio
2. üåø Crea una rama: `git checkout -b feature/nueva-funcionalidad`
3. üíª Realiza cambios y commits descriptivos
4. üß™ Ejecuta tests: `npm run test`
5. üîç Verifica linting: `npm run lint`
6. üì§ Push: `git push origin feature/nueva-funcionalidad`
7. üîÄ Crea Pull Request

## üìÑ Licencia

Este proyecto est√° bajo la Licencia MIT. Ver el archivo `LICENSE` para m√°s detalles.

---

**üöÄ ¬°Desarrollado con React 19, TypeScript y las mejores pr√°cticas de desarrollo moderno!**
